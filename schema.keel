role Sailors {
    domains {
        "keel.xyz"
    }
}

enum Gender {
    Male
    Female
    Nonbinary
    Other
}

enum Region {
    Asia
    Americas
    Africa
    Mena
    Europe
    Poles
    Oceania
}

job FetchNewBooks {
    @schedule("*/5 * * * *")
    @permission(true)
}

model Book {
    fields {
        isbn Text
        title Text?
        author Author?
        published Date?
        owner Identity
    }

    operations {
        get book(id) {
            @permission(expression: true)
        }
        list allBooks() {
            @permission(expression: true)
        }
        delete deleteBook(id)
        update updateBook(id) with (isbn?, author.id?, published?, title?)
        create createBook() with (i sbn, author.id?, published?, title?) {
            @set(book.owner = ctx.identity)
            @permission(expression: true)
        }
    }

    @permission(
        expression: ctx.isAuthenticated,
        actions: [create]
    )

    @permission(
        roles: [Sailors],
        actions: [get, update, delete, list]
    )
}

model Author {
    fields {
        givenname Text
        surname Text
        gender Gender
        region Region
    }
}
